{"ast":null,"code":"import axios from 'axios';\n\nconst getState = ({\n  getStore,\n  getActions,\n  setStore\n}) => {\n  return {\n    store: {\n      message: null,\n      token: null,\n      isAuthenticated: false,\n      user: null,\n      test: 'store working'\n    },\n    actions: {\n      getTest: () => {\n        console.log('actions working');\n      },\n      syncTokenFromSessionStorage: () => {\n        const token = sessionStorage.getItem(\"token\");\n        console.log(\"refreshin, syncing tokens\");\n\n        if (token && token != \"\" && token != undefined) {\n          setStore({\n            token: token\n          });\n          const action = getActions();\n          action.getuser().then(setStore({\n            isAuthenticated: true\n          }));\n        } else {\n          setStore({\n            token: null,\n            isAuthenticated: false,\n            user: null\n          });\n        }\n      },\n      login: async (email, password) => {\n        console.log('logging in');\n        const opts = {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            password: password\n          })\n        };\n\n        try {\n          const resp = await axios(process.env.REACT_APP_API_SERVER + \"/api/auth/create-token\", opts); //console.log(resp.status, resp.data.access_token);\n\n          if (resp.status !== 200) {\n            console.log(\"Error 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          sessionStorage.setItem(\"token\", data.access_token);\n          setStore({\n            \"token\": data.access_token\n          });\n          const action = getActions();\n          action.getuser().then(setStore({\n            \"isAuthenticated\": true\n          }));\n          return true;\n        } catch (error) {\n          console.error(\"Error 2\", error);\n          throw error;\n        }\n      },\n      register: async (email, name, password) => {\n        console.log('Registering User');\n        const opts = {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            name: name,\n            password: password\n          })\n        };\n\n        try {\n          const resp = await axios(process.env.REACT_APP_API_SERVER + \"/api/auth/create-user\", opts); //console.log(resp.status, resp.data.access_token);\n\n          if (resp.status !== 200) {\n            console.log(\"Error create-user 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        } catch (error) {\n          console.error(\"Error creat-user 2\", error);\n          throw error;\n        }\n      },\n      logout: () => {\n        sessionStorage.removeItem(\"token\");\n        setStore({\n          token: null\n        });\n        setStore({\n          isAuthenticated: false,\n          user: null\n        });\n        console.log(\"tokens removed, logged out\");\n      },\n      getuser: async () => {\n        console.log('getting user details');\n        const store = getStore();\n        const opts = {\n          headers: {\n            \"Accept\": \"application/json\",\n            \"Authorization\": \"Bearer \" + store.token\n          }\n        };\n        const resp = await axios(process.env.REACT_APP_API_SERVER + \"/api/auth/userdata\", opts);\n\n        if (resp.status == 200) {\n          console.log(\"setting store.user\", resp.data);\n          setStore({\n            user: resp.data\n          });\n          return true;\n        }\n      },\n      create_post: async polldata => {\n        console.log('Creating Post', polldata);\n        const store = getStore();\n        console.log(store);\n        const apidata = {\n          'question': polldata.question,\n          'options': polldata.options\n        };\n        const opts = {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"Authorization\": \"Bearer \" + store.token\n          },\n          data: JSON.stringify(apidata)\n        };\n\n        try {\n          const resp = await axios(process.env.REACT_APP_API_SERVER + \"/api/polls/createpoll\", opts); //console.log(resp.status, resp.data.access_token);\n\n          if (resp.status !== 200) {\n            console.log(\"Error create_post 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        } catch (error) {\n          console.error(\"Error create_post 2\", error.code);\n          return false;\n        }\n      }\n    }\n  };\n};\n\nexport default getState;","map":{"version":3,"sources":["/home/johnrijoy/projects/polling-webapp/pollo_frontend/src/context/contextData.js"],"names":["axios","getState","getStore","getActions","setStore","store","message","token","isAuthenticated","user","test","actions","getTest","console","log","syncTokenFromSessionStorage","sessionStorage","getItem","undefined","action","getuser","then","login","email","password","opts","method","headers","data","JSON","stringify","resp","process","env","REACT_APP_API_SERVER","status","setItem","access_token","error","register","name","logout","removeItem","create_post","polldata","apidata","question","options","code"],"mappings":"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","sourcesContent":["import axios from 'axios';\n\nconst getState = ({ getStore, getActions, setStore }) => {\n  return {\n    store:{\n      message: null,\n      token: null,\n      isAuthenticated: false,\n      user: null,\n      test: 'store working'\n    },\n    actions:{\n\n      getTest: ()=>{\n        console.log('actions working')\n      },\n\n      syncTokenFromSessionStorage:()=>{\n        const token = sessionStorage.getItem(\"token\");\n        console.log(\"refreshin, syncing tokens\")\n        if (token && token != \"\" && token != undefined ) \n        {\n          setStore({token: token });\n          const action = getActions();\n          action.getuser().then(\n          setStore({isAuthenticated: true }))\n        }else{\n          setStore({\n            token: null, \n            isAuthenticated: false,\n            user: null\n          });\n        }\n      },\n\n      login: async (email, password)=>{\n        console.log('logging in');\n\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            password: password\n          })\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-token\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          sessionStorage.setItem(\"token\", data.access_token);\n          setStore({ \"token\": data.access_token });\n          const action = getActions();\n          action.getuser()\n          .then(\n          setStore({\"isAuthenticated\" :true }))\n          return true; \n        }\n        catch(error){\n          console.error(\"Error 2\", error);\n          throw error;\n        }\n      },\n\n      register: async (email, name, password)=>{\n        console.log('Registering User');\n\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            name: name,\n            password: password\n          })\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-user\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error create-user 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        }\n        catch(error){\n          console.error(\"Error creat-user 2\", error);\n          throw error;\n        }\n      },\n\n      logout: ()=>{\n        sessionStorage.removeItem(\"token\");\n        setStore({ token: null });\n        setStore({isAuthenticated : false, user: null });\n        console.log(\"tokens removed, logged out\")\n      },\n\n      getuser: async ()=>{\n        console.log('getting user details');\n        const store = getStore()\n        const opts={\n          headers: {\n            \"Accept\": \"application/json\",\n            \"Authorization\": \"Bearer \"+ store.token \n          }\n        }\n       \n      const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/userdata\", opts)\n         \n      if (resp.status == 200){\n          console.log(\"setting store.user\",resp.data);\n          setStore({user: resp.data});\n          return true;\n      }\n      \n          \n\n      },\n      \n      create_post: async (polldata)=>{\n        console.log('Creating Post', polldata);\n        const store = getStore()\n        console.log(store);        \n        const apidata = {\n          'question':polldata.question,\n          'options':polldata.options\n        };\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\",\n            \"Authorization\": \"Bearer \"+ store.token \n          },\n          data: JSON.stringify(apidata)\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/polls/createpoll\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error create_post 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        }\n        catch(error){\n          console.error(\"Error create_post 2\", error.code);\n          return false;\n        }\n      }\n\n\n    }\n  };\n};\n\nexport default getState;\n"]},"metadata":{},"sourceType":"module"}