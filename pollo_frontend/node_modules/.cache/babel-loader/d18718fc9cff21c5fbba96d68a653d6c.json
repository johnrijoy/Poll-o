{"ast":null,"code":"import _regeneratorRuntime from\"/home/johnrijoy/projects/polling-webapp/pollo_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/johnrijoy/projects/polling-webapp/pollo_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from'axios';var getState=function getState(_ref){var getStore=_ref.getStore,getActions=_ref.getActions,setStore=_ref.setStore;return{store:{message:null,token:null,isAuthenticated:false,user:null,test:'store working'},actions:{getTest:function getTest(){console.log('actions working');},syncTokenFromSessionStorage:function syncTokenFromSessionStorage(){var token=sessionStorage.getItem(\"token\");console.log(\"refreshin, syncing tokens\");if(token&&token!==\"\"&&token!==undefined){setStore({token:token});var action=getActions();action.getuser();}else{setStore({token:null,isAuthenticated:false,user:null});}},login:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(email,password){var opts,resp,data,action;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('logging in');opts={method:\"POST\",headers:{\"Content-Type\":\"application/json\"},data:JSON.stringify({email:email,password:password})};_context.prev=2;_context.next=5;return axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-token\",opts);case 5:resp=_context.sent;if(!(resp.status!==200)){_context.next=9;break;}console.log(\"Error 1\");return _context.abrupt(\"return\",false);case 9:_context.next=11;return resp.data;case 11:data=_context.sent;console.log(\"Backend data:\",data);sessionStorage.setItem(\"token\",data.access_token);setStore({\"token\":data.access_token});action=getActions();action.getuser();return _context.abrupt(\"return\",true);case 20:_context.prev=20;_context.t0=_context[\"catch\"](2);console.error(\"Error 2\",_context.t0);throw _context.t0;case 24:case\"end\":return _context.stop();}}},_callee,null,[[2,20]]);}));function login(_x,_x2){return _login.apply(this,arguments);}return login;}(),register:function(){var _register=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,name,password){var opts,resp,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('Registering User');opts={method:\"POST\",headers:{\"Content-Type\":\"application/json\"},data:JSON.stringify({email:email,name:name,password:password})};_context2.prev=2;_context2.next=5;return axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-user\",opts);case 5:resp=_context2.sent;if(!(resp.status!==200)){_context2.next=9;break;}console.log(\"Error create-user 1\");return _context2.abrupt(\"return\",false);case 9:_context2.next=11;return resp.data;case 11:data=_context2.sent;console.log(\"Backend data:\",data);return _context2.abrupt(\"return\",true);case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](2);console.error(\"Error creat-user 2\",_context2.t0);throw _context2.t0;case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[2,16]]);}));function register(_x3,_x4,_x5){return _register.apply(this,arguments);}return register;}(),logout:function logout(){sessionStorage.removeItem(\"token\");setStore({token:null});setStore({isAuthenticated:false,user:null});console.log(\"tokens removed, logged out\");},getuser:function(){var _getuser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var store,opts,resp;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log('getting user details');store=getStore();opts={headers:{\"Accept\":\"application/json\",\"Authorization\":\"Bearer \"+store.token}};_context3.prev=3;_context3.next=6;return axios(process.env.REACT_APP_API_SERVER+\"/api/auth/userdata\",opts);case 6:resp=_context3.sent;if(!(resp.status===200)){_context3.next=12;break;}console.log(\"setting store.user\",resp.data);setStore({user:resp.data});setStore({isAuthenticated:true});return _context3.abrupt(\"return\",true);case 12:_context3.next=18;break;case 14:_context3.prev=14;_context3.t0=_context3[\"catch\"](3);console.error(_context3.t0.response.status,_context3.t0);if(_context3.t0.response.status===401)getActions().logout();case 18:case\"end\":return _context3.stop();}}},_callee3,null,[[3,14]]);}));function getuser(){return _getuser.apply(this,arguments);}return getuser;}(),create_post:function(){var _create_post=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(polldata){var store,apidata,opts,resp,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log('Creating Post',polldata);store=getStore();console.log(store);apidata={'question':polldata.question,'options':polldata.options};opts={method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \"+store.token},data:JSON.stringify(apidata)};_context4.prev=5;_context4.next=8;return axios(process.env.REACT_APP_API_SERVER+\"/api/polls/createpoll\",opts);case 8:resp=_context4.sent;if(!(resp.status!==200)){_context4.next=12;break;}console.log(\"Error create_post 1\");return _context4.abrupt(\"return\",false);case 12:_context4.next=14;return resp.data;case 14:data=_context4.sent;console.log(\"Backend data:\",data);return _context4.abrupt(\"return\",true);case 19:_context4.prev=19;_context4.t0=_context4[\"catch\"](5);console.error(\"Error create_post 2\",_context4.t0.code);return _context4.abrupt(\"return\",false);case 23:case\"end\":return _context4.stop();}}},_callee4,null,[[5,19]]);}));function create_post(_x6){return _create_post.apply(this,arguments);}return create_post;}()}};};export default getState;","map":{"version":3,"sources":["/home/johnrijoy/projects/polling-webapp/pollo_frontend/src/context/contextData.js"],"names":["axios","getState","getStore","getActions","setStore","store","message","token","isAuthenticated","user","test","actions","getTest","console","log","syncTokenFromSessionStorage","sessionStorage","getItem","undefined","action","getuser","login","email","password","opts","method","headers","data","JSON","stringify","process","env","REACT_APP_API_SERVER","resp","status","setItem","access_token","error","register","name","logout","removeItem","response","create_post","polldata","apidata","question","options","code"],"mappings":"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","sourcesContent":["import axios from 'axios';\n\nconst getState = ({ getStore, getActions, setStore }) => {\n  return {\n    store:{\n      message: null,\n      token: null,\n      isAuthenticated: false,\n      user: null,\n      test: 'store working'\n    },\n    actions:{\n\n      getTest: ()=>{\n        console.log('actions working')\n      },\n\n      syncTokenFromSessionStorage:()=>{\n        const token = sessionStorage.getItem(\"token\");\n        console.log(\"refreshin, syncing tokens\")\n        if (token && token !== \"\" && token !== undefined ) \n        {\n          setStore({token: token });\n          const action = getActions();\n          action.getuser()\n        }else{\n          setStore({\n            token: null, \n            isAuthenticated: false,\n            user: null\n          });\n        }\n      },\n\n      login: async (email, password)=>{\n        console.log('logging in');\n\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            password: password\n          })\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-token\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          sessionStorage.setItem(\"token\", data.access_token);\n          setStore({ \"token\": data.access_token });\n          const action = getActions();\n          action.getuser()\n          return true; \n        }\n        catch(error){\n          console.error(\"Error 2\", error);\n          throw error;\n        }\n      },\n\n      register: async (email, name, password)=>{\n        console.log('Registering User');\n\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\"\n          },\n          data: JSON.stringify({\n            email: email,\n            name: name,\n            password: password\n          })\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/create-user\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error create-user 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        }\n        catch(error){\n          console.error(\"Error creat-user 2\", error);\n          throw error;\n        }\n      },\n\n      logout: ()=>{\n        sessionStorage.removeItem(\"token\");\n        setStore({ token: null });\n        setStore({isAuthenticated : false, user: null });\n        console.log(\"tokens removed, logged out\")\n      },\n\n      getuser: async ()=>{\n        console.log('getting user details');\n        const store = getStore()\n        const opts={\n          headers: {\n            \"Accept\": \"application/json\",\n            \"Authorization\": \"Bearer \"+ store.token \n          }\n        }\n      try {\n      const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/auth/userdata\", opts)\n         \n      if (resp.status === 200){\n          console.log(\"setting store.user\",resp.data);\n          setStore({user: resp.data});\n          setStore({isAuthenticated: true });\n          return true;\n      }\n      }\n      \n      catch(error){\n       console.error(error.response.status, error);\n       if (error.response.status === 401) getActions().logout();\n      }      \n\n      },\n      \n      create_post: async (polldata)=>{\n        console.log('Creating Post', polldata);\n        const store = getStore()\n        console.log(store);        \n        const apidata = {\n          'question':polldata.question,\n          'options':polldata.options\n        };\n        const opts={\n          method: \"POST\",\n          headers: {\n            \"Content-Type\":\"application/json\",\n            \"Authorization\": \"Bearer \"+ store.token \n          },\n          data: JSON.stringify(apidata)\n        };\n\n        try{\n          const resp = await axios(process.env.REACT_APP_API_SERVER+\"/api/polls/createpoll\", opts);\n          //console.log(resp.status, resp.data.access_token);\n          if (resp.status !== 200){\n            console.log(\"Error create_post 1\");\n            return false;\n          }\n\n          const data = await resp.data;\n          console.log(\"Backend data:\", data);\n          return true;\n        }\n        catch(error){\n          console.error(\"Error create_post 2\", error.code);\n          return false;\n        }\n      }\n\n\n    }\n  };\n};\n\nexport default getState;\n"]},"metadata":{},"sourceType":"module"}